#include <cassert>
import std;

using namespace std;

static auto basic_problem(string_view data) {
    vector<int> disk;
    // XXX: avoids any subsequent resizes of the buffer. 9 is a factor based
    //      on each consecutive section being at most 9 blocks long.
    disk.reserve(data.size() * 9);
    auto file_id = 0;
    bool is_free = false;
    for (const auto c : data) {
        int n = c - '0';
        for (int i = 0; i < n; i++) {
            disk.push_back(is_free ? -1 : file_id);
        }
        is_free = !is_free;
        if (!is_free) {
            file_id++;
        }
    }
    auto front = 0;
    auto back = disk.size() - 1;
    while (front < back) {
        if (disk[front] == -1) {
            if (disk[back] != -1) {
                disk[front] = disk[back];
                front++;
            }
            disk.pop_back();
            assert(back == disk.size());
            back--;
        } else {
            front++;
        }
    }
    return ranges::fold_left(
        disk
        | views::enumerate
        | views::transform(
            [](const auto& b) {
                const auto [index, value] = b;
                return index * value;
            }),
        0,
        plus());
}

static auto advanced_problem(string_view data) {
    list<pair<int, int>> disk;
    auto file_id = 0;
    bool is_free = false;
    for (const auto c : data) {
        int n = c - '0';
        disk.push_back(make_pair(is_free ? -1 : file_id, n));
        is_free = !is_free;
        if (!is_free) {
            file_id++;
        }
    }
    auto it = prev(disk.end());
    while (it != disk.cbegin()) {
        if (it->first != -1) {
            for (auto jt = disk.begin(); jt != it; jt++) {
                if (jt->first == -1 && jt->second >= it->second) {
                    disk.insert(jt, *it);
                    jt->second -= it->second;
                    it->first = -1;
                    // XXX: after doing this there will be consecutive
                    //      empty-space spans but we don't care as we would
                    //      never reattempt placing any file inside these.
                    break;
                }
            }
        }
        it--;
    }
    auto pos = 0;
    auto checksum = 0LL;
    for (const auto& [id, len] : disk) {
        if (id == -1) {
            pos += len;
        } else {
            for (auto i = 0; i < len; i++) {
                checksum += pos++ * id;
            }
        }
    }
    return checksum;
}

int main() {
    auto small_vector = R"(2333133121414131402)"sv;
    auto large_vector =
        "2378984580121520505930414446619015763552254236131228507744846522796247291626876463763556946912861452548524349536664248882715601886972771266057508255974582502497516580516230639351796322994373788969746852705458592550888399898574349029716597285229426155611176455883193664625020468455952536507361762145279392476941196162991574955145267828812260293292459177217150908841914969253174884880104377103132376869257225616384421272417089229952593327534384622532292462917552158794635925222175411448598283716549972035725859118482496293366879353578241876336442699442321945989352959995245253652755182189365693902473533822862236381585169972756459453638793660893996852296881874443313543194497787231370558934379689668959571116597696867555803036736054557968481159511248465866668332453616469849131270824079788473709572247855377282734480287958513420862644385727632314959556183993607284693216704113757013381329112153622933266121399843321439977644292476853682286244521224881625823919703469524759857954201157828918356461457778567832549688208190349061588210149791545118339165767317757574321977551825191870154819233535267610507814258088267860429874254610956540257839897838649945867695129940983973609750536378628983808190323652349413485143293095503016118739851419904748701827143357758817848551354065442482891214375748687288309687893759224660109298577232568585328545522819178084275725164438453279219414156944605941475028714087859633115098221023491268463253572545437796715175607380791043962730959321576980833533801257468487896934839857119445245067976935818024817198615470288615954638283664348293146511867892104066429585684386751592639240519662844433636050344246507860658686836078639723697541764871803847667674867680177850324815833955788698126721979726895586976310165617578214936984236127494122539431109791235026876712747383297034805148874015842837786567159828669458765044439920991171731787384796474151561147573691368798403588951655337248403197863368243240471648853277986935396995212189692584746615279942934321203910476880756795106544191158981614638811163610563746176255509412814595648347999296512985455988744537231739842420946319824443156380345568531063635064829425285879789194143017241676729126161614979734911883676364754890987140872222658498535089222998702355229831984283663433553695528972827553749232269113554593818696554473678790652693952367585412495593358953777245881279282513527853495316298477505751246491765047677688458715512617566973586192885652996810505966429036401824581981156235491673745750917983177597869891888271611997425328491651204791511343659823516515889012177024247359819623769584383887392396794773951255722384992853748961286511845981385637383554429064132254183522522547564162713031105490794255252289593841194785793693439315745498454934525822734324431857803356743840291533586870529649569336833533297372582484854578439273847366101016628743821197872527348497645385674476823452741195994913674156431081438156912546719565411839331142746782182742941926982086507111816562426954151518533931965557157098868647222734266535734497527681809339788342515367248077914446463966918417987812592917162530998812469227863760859693725474366744836758799984188866407430289978966430804416812652856954414656821963819223255065511847377996107644822668703590266959949676443758953327232239879952628273864819688222925799634241363923917261285878636945538698952917813672703654571973896155751020376193984813536455963387148541339224513891776052761632512170475152678858283695692338424827332733136592243514149634308072902984996966916197793745683942785825682772987518903034912687843031774818765089583332473428955625391422176665964066492372334841877316184841484431841236646837411260191279106614689195762680985185167376115935916720901080509315308954239642478122807030233167504635129332243064281130352114331152128848222280487057863147908278512683768736374430362483265369369166318860403754854540841758108936878776281125573151255440702345266146574373903734846157454956541714661541192235941598201128633120847365338595654478859923957447963070668037111168886737908538751010232650509532847814248175355196983119842925265865314762807455657328974847968896113145151636622164664956901197426916875973989478543467844981461977968699357266515156309484267063565657417249763597402081817770916278287557714717814622626092467289732320257557223829972277739497421178719492117383945041613143269838126618192690472094713025163867947817417114754292637294679886302820584734896658883329746164753244715826976327276714937553107933345684349171472069118621432176203924955122127510122940587451438188626832293928902034719851926633318712337456348682715071897680587311239781111867581253996069942863678366308925194639473650704948911893598426533461325882192359712345632953185626622396212131462965285596157321476827435486879053351951292363378514419126903376974999922444529517507118698981942577752524274513712586785028753499193470145475428756174126379019387175719854363625492739284855685922615892713132441235978566252040538535304477137335493729495967321851194256952949409382705145677199825175549"
        "5712048894240592199864881352444439636586686889635156031543368744490207056401477591385313624383812748593567319282154627260572955421641449278244536833781511858155759749045587181205147489156818571485857567617601254512615369182954761654053674827394730405293512315353272215852277044785848423019939393407767419816361076102253826533848395131669991683608095637697169527404396366825427926283269333887601996199093235373798240673430894017852716763514188195313724456717515845448722664957957678951214354226654392909274702819461135646712895654686484727113479564993811153864317870829141246195376873319060996434247849184344254185118029452882739157817088731967993139204342478145613533901640273372206612334244982236723969426730948775784094584410554433687350763092242791965843345576764084791153262013616156255190333446547694486362899527546532995168967772624290763329567038387814551413306897533428843618361188305093476976967014404028719442292441149522933089804363135672743744429593581326456838396567691481837495867241422912876860137522374562879933928340887221647893611966229086922312733226852391342370689617255732514116917274683786328599418975497137879134871675344346772870707426272746139780927346763326661485702553151687286736595489695739173868374093177326378239564439661182511327197252323693729379947521734768987499592941521698906111512832868274994958174158297574959046675329847956498296421775906742104658868553362441305681618753575593307925221395479611927172825427192295677523158823865269683840269434447835735465554498141853146091784625563143847339563638128590627084644655415632447269278458908420491413994234308927981769191519826646426660589452346885286173906531248744409116261753389322999726924532717713261067801236688486588647132662527669459655963044107939574745307715461537461731594469637393461398411038346597216678158514173756599826782789144143696693454148744073894492492139588678722622434643548340328310808556335951611988645869374386434413793384343924658730266733406926813498386921667524868056103898424354274060673631578260454682801030154027298053911511825889575949595461282957947577684211264254157494287211676364734670688712708012391993474029828860781247253322154713288069976538764878522672329861245038594798253229276982363196469659266293269258581365942132168080566446232081719153596944927383224766707143401236249365849657179770207268645778768845372512458990475246475636131860288086972740648982783682591085679721781939406941884619687331859344232554918774916998918563521179987985273467707533422228394913327335574122785690912879954363654372497195193392623763965110693425927593254772383858956520507169386784756177577680315182764080707179742528756835412786644867602269371286347711762512392264314548717768323815242466515625491240613028548520887481998124492628238476778711712961423551624047402412203615756770651630898546295294641282698523202020124414797366188351991327483755614881725761187872607725535563731127376575711949135546924939933042627515495013333464138091467921969822863533133120367874588098822882272136691975929744991231461766738064696052753348953115777859889161979199259787741829235548214814171869702228176173514596806418575472424616993186478674219135973622964794317438377292354588148881938496837012201315517418891899674483932060518689174770857246951033827390628791555816847969613976119220949443514983123552322618332660401875739643825197611269959535523336707034704751375799561328153850315126986189862347251398821011104490537712192767238634392431977692758829426327222576802570158577571851995813487899952440103640903212926138672710506360532323833341674042669651557895875665392861468595477085693488769834184539926110284116622870765632194467396847199959519846792213463983132950627154144159401485571259775194395482527462566388813042181986517371238297293231403770513593296162241620971229154281616879715155413875339469857778456897289688613581816122674755247726509558756919323045706524337929554992809453349131171715483494343614184084749693413810879287273087899924555189582594169963688620741238235016931146924744133728959783617140664463654313113158537186111497391484362687644050948396716727833289836557378356156677769811299920293832728138672515468785967823506491179950611455413617105544476825141753338649343414792689705270908411679872348912503529211836388397483758992244287633142021306117881413897446252069969042213716219160232816185593243176659726995496965176181258194638996894992596471128476525909359507776305460689479525574238333622754587773494510561158981338589722174676426458705465468135487898424261472961729064191157902089516226758335322436523670454940356221729911455650131915714113778710617544958380872465975566475834131469321945325251265667184089533463527575359928412737392661344950354222381157856738791648348544553783353532108338445376877533991767671714608813245267479089683041648716231946786534658024378826847821236943127146368135179463407376999499628995412176922095617034586754312766697250185845494958652937654830924624387930943881871363215342354087829450553786537257146612759490731371906586117762942772"
        "9695528840204686132221858397264622898233833141536927767279747055429893937129988974907872679267388185613591481642583862968451425490147459436062388123376821649868774547258416101221196838922461315152167932268814475254172913813855797574578624504237789895295154373925887752952798411176921395614937817730691736219441758383943116179684594825304920537912207255265389653438902861706416291332845445288062981813773925413447389770111614517545489817783232468447932587955363626523794099465156735393667048552433784315252963562423689367733424988780937728252018542571284272192324919461248631134222891632396267953955878395123096454394418585993818454844457220296651702942815874492198651314176433992446514576447339167198314726883514617376828667979892523762145415922792193666511684758784309760309780353543548586936020937048784361967075373941565630521585813471894087592022307053344083955578429652339138811912404648611743411888453739142819586250722642542790133886602473756390754124537810908057492917476686224784626929412356803661795078835177345398256612476121174599102840258089266648274612208874442284865692637150816756392798243859741645437811842823326676513347139376803953727249221327632932949311211756831067403728127726484747679979419792865016615599409740219043359677852099675940486991464042599139369886992547323533619389835221962276863851406510514259872679893287908899536169222635735480784175805957579520385935787413642375923092102361625428602623699520876211834517692575238852761111868685516116912235673667845645377416268975486359645578156361713451762514976029696412465858621551541925813310703813156442359787879241727944911842808795647744353381257471618666157610879722833535208954568737812140975674908637587743364472707687522996388040329647307796957496394254656764803649631424242818116464724149348591262691297299226880172241365683411959535346221379613392337295884617269174676239461689142856373433854292722419707491752856689162694491382326166151814460585332496569139560209325432677486037404113289655225841283983344976747666138324719649318314366721869218282171249929325285322119576374578699919252611051443528508498124314375019189513708867575925835235612320685677615241161190665252747748609432191671881171286040909970234036218348559836935935546341655125925231757064979264549594977728488044836862308639121339667644802732823261424812425911211145546229369751878145455762501849991315726330952096961123174370143627106949864174732018835024922997814932579150114440164145745032154167142088245197462127268929804131719941637471966675591813716094786232422631571715332542795943603573894538488343608236385673277435611043221714454299822125183038861451507678757589359248925810929252428774496214524993633913259451109226509091204611234917455498437756499016806257479056205963747661343330725947326481615745956125647237332880873514814334943424485785493327852115709742521183132737783874262927658453959572877747527223722251805672331426271917194930872214787580889094341341414495415741788263943120709077564837889196796145974660659918596363458659464442512616536792694660563286631812532156603188424035617351931136773195328538503254257160428166132458835717713158135344771614387596569025314291317024271818749326643211889154604827301371715029318410456158878840524787364058408758395158748919247892484095595323253165489354925092869671163353274073968428173161664028118255661783338147885240602822373636126199465578534427217744818653174040634316429022602984353823808420707112248344294072157423423491547992561889708053718871881085273292439636502726502161175845924085721332638053597942466930827253317423554667372011836547907593229198915457922273432886756686862631387057797161559368264773742028763640512075474440611369952910567468259328912584189225663194633920236880811510699786635028648290377930899633764173429020553949624750214632341478349994335767822978621136485745896178396214275553898817455628119233772235865682535748868839982395469264163789817012341562599623843049166491325941646630107236826197486422246248973415706513257220719114631268815117761713812780586647731020415495145978748169899544376747146874425769656198892356517983426687744097736244381174562082931490357261384259822269112019636766165656293999951389421886451277656183253849316171146617647677873651116614151861418322967792456768401414291817701318648914262068818622335189315194407098343685321486236959366055614166807664206998752827897815191220335644977110997123569683536116691462323836323011531416877478879863363847411666591767263398876015719080302557101486175526479110591795918739284312139971928229913528628653121863371936108372927599787610293635971986116764843816468014132912149375832295879463881965201198875880695322972085715035879173451586314419341518502489906585335492201219431135697237284916848270715419721239331356914412195450235383823110215146989766844542993552844731483423726182337793522562249649683268461455987998629223367245406676377083528637858193708452256972285538455691275455622360524877719898249398637091454777416262667343263214406378673370712840775739533424254165527239176975415"
        "6894279737251673458264255255164483250517478273023261923371489891635758493538732693155547293682042259482523347703784485632726744747122338754878140433514858113944412993562361833782539755584496673667463161177642874956569242150917595977026843721289396424187369123295873641282141470114826705541463579237625453818613578504065862714764548129718653247121150117095907486369652454741867653555480843213563291857969883558928378863233808698944230335088424044581024547670792769215252532351352760696457317976928265962486548283794241659836397815179072535281735695153286529074922587652487719941497758122094675234279039852166852741782063374998455436527919928648676868353395265616509765939739952362213098685359193486477060451621652970276618148490947234796770683187621133131218359768837962911790904427222032695143432317371679451434913798137054989647905684563124993562648435555216123186916878957164277210349325511575265513851515401972914592348232416696793673189522906086835892595459361790511212489190703462401961105720133231498611642243286579117122588229833541989098138224577345824932276781908546108678222684379749958845845945998271573476557638585962667037491483668419705318614947386925692694729811177289538390891081516459606859957616195820408288593857131356312056882156276622982798204066579218882187656718687064964650106388509212244447711526385399973728803536556773829088411928165314447764514015997065477567158784437833957859845573938591795545959656265540126671876280237223532396507295866484459238493452733259621016189678855279389281784654545768298165675734935929596788207561319456524720181444941719315565201164845126425431248711519959626718929841634024101887242520301615177480252843657490521915221419347147439296359043482148692953523985936121746640207962217580844674583419114320109382137211965713745749117236529475698235715575339852985485637191927997742558227598379742799924528052794475499546147846694786453114593485625263964796396857894039542986707551393576805436491368125170584214385842876736184950701845807552293982543038801381447120227439205592896980601093944264335856146430832822158731995420496722211721677325196331727391678280528950447085276273801654343441632619767232668161433669526574802191308173666561311481501651168185831758462130407389656990596412635775276699961415379428848951365266797098318491184873581550836747415064722064557396939270989861811367589997184645567713421924297381558487402182598329103168737347847118294986642754179886246418815255366069969614443364318135501256387094724439251141741746576494283131877647798278769281268140525353619423933289249425436921746173918279511587223053503665387328812911876743462949595369365710373243348716681089836025773654815277886662239775807680287537417193788712738078695395283337953428331169801341834349426116207292186665416363282283523047455668599043461474534265963583185867161192985973415353961330172946127390774274688344463430505266723721411549898063183376297493391991479899709663896640277692965863233341458323928928357250234719898573342661727242242557883757458459493146628310741656612312988622127797711993283276772943824899115754651752847292795394388234616233472655119542711423217973169078949626891017594292143067811480597090717735813951904296237542552869922520731316909134592751272315498868796718409410179048516565285119433692391948811716451432462369436560294293682884973790579422862214478548138288579745698663678750568199819059319612335280199921316119513066722341834827589810631450616586424240618227507735388176579588565070827180442332898684775675352183809863653555275884737581567047313620744483213857732038215331833868316333712245965645273791992095759928906295769174247592946262752838149878848320901337183633327032118184423436682915113640617445882330201694633371109974221874123411917651968358118872131525866881578546495422545120866643296538386937914316262082365561665017628212744728241617746015945023679941385612952937368728941553885172474482298113539845375569845269284058265081214123216843914895819597507544824574682435682121585026692023275834965477622420394224701771683949656217497647357287771942751715873814155488989674906692782350606366598223456652563841852745224827772854757455763124198013688548736059996658135912124546959463145216771931365311751434654768941644688758456153716883819454247832799437314899841274498844152569894072137565758612973061146815749990252484371811593321948027926538203221237627893820318578762242445756773344727728624644899115703649797825949053934252565932302748968239498520968485376024972933375627931013881446466745546080933115804948263590605649169019589322376426574669165841902113221523748230259445688267207427669655555856192450908581591860485298738034804232467840172175328534647160992633775717639457907035847714833049829017771567227955904664824576978590161925456951657551578523539438359698581948867669696324575723603720154657884585766322604327668531402640868689749889684036735566117740572597833396662041898532516692477339896849888291484877342991261341943115779952642648741173575710822167305324425859415921428247134462182027541730"
        "608"sv;
    cout << basic_problem(small_vector) << endl;
    cout << basic_problem(large_vector) << endl;
    cout << advanced_problem(small_vector) << endl;
    cout << advanced_problem(large_vector) << endl;
    /*
    */
    return 0;
}
